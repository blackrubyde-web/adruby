import{s as U}from"./creative-C4rWjoa1.js";const A=[502,503],_=15e3,E="".replace(/\/+$/,""),b=t=>new Promise(e=>setTimeout(e,t));async function k(){var o;const{data:t}=await U.auth.getSession(),e=(o=t.session)==null?void 0:o.access_token;return e?`Bearer ${e}`:null}async function c(t,e={}){const{method:o="GET",headers:p={},body:T,timeoutMs:R=_,retries:l=2,retryDelayMs:w=300,auth:g=!0}=e;if(!t.startsWith("/"))throw new Error('apiRequest path must start with "/"');const S=E?`${E}${t}`:t;let n=0,h=null;for(;n<=l;){const d=new AbortController,f=setTimeout(()=>d.abort(),R);try{const r=g?await k():null,s=await fetch(S,{method:o,headers:{"Content-Type":"application/json",...r?{Authorization:r}:{},...p},body:T!==void 0?JSON.stringify(T):void 0,signal:d.signal});clearTimeout(f);const u=await s.text(),i=u?JSON.parse(u):null;if(!s.ok){const a=i&&typeof i=="object"?i:null,P=(a==null?void 0:a.error)||(a==null?void 0:a.message)||u||"Request failed",m=new Error(P);if(m.status=s.status,A.includes(s.status)&&n<l){await b(w*(n+1)),n+=1,h=m;continue}throw m}return i}catch(r){clearTimeout(f),h=r;const s=r;if(!((s==null?void 0:s.name)==="AbortError")&&(A.includes((s==null?void 0:s.status)??0)||(s==null?void 0:s.status)===void 0)&&n<l){await b(w*(n+1)),n+=1;continue}throw r}}throw h||new Error("Request failed")}const y={get:(t,e)=>c(t,{...e,method:"GET"}),post:(t,e,o)=>c(t,{...o,method:"POST",body:e}),put:(t,e,o)=>c(t,{...o,method:"PUT",body:e}),patch:(t,e,o)=>c(t,{...o,method:"PATCH",body:e}),delete:(t,e)=>c(t,{...e,method:"DELETE"})};export{y as a};

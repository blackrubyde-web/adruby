import{r as o,j as e,S as me,R as Ee,a as Ie,I as Pe,F as Re,C as $e,u as Fe,b as Be,U as Ue,X as Oe,c as Le,T as De,d as Ve,e as ye,V as Me,P as qe,f as Je,g as Ge,h as We,i as He,k as Qe,l as Ke,m as Xe,n as Ye,o as Ze,p as et,q as tt,L as st,s as at,t as rt,v as nt,w as it,x as lt,y as ot,z as dt,A as ct,B as we,D as ut,E as mt,G as xt,H as ft,J as ht,K as gt,M as pt,N as vt,O as bt}from"./vendor-react-BtVdps6C.js";import{t as jt,c as yt,a as xe,o as w,b as W,e as H,s as c,l as Ne,d as wt,n as Nt,f as ae,g as St}from"./vendor-Cwcl6ryW.js";import{c as Ct}from"./vendor-supabase-CX3WxO18.js";function m(...t){return jt(yt(t))}console.error("[supabase] Missing VITE_SUPABASE_URL / VITE_SUPABASE_ANON_KEY");const I=Ct("","",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"}}),Se=o.createContext(null);function kt(t){if(!t)return!1;const s=new Date(t).getTime();return Number.isFinite(s)&&s>Date.now()}function ds({children:t}){const[s,a]=o.useState(null),[r,i]=o.useState(null),[n,d]=o.useState(null),[N,j]=o.useState(!0),[O,y]=o.useState(!1),[$,f]=o.useState(null),[L,R]=o.useState(null),F=o.useCallback(async()=>{try{await I.rpc("ensure_user_profile_exists")}catch(l){console.warn("[Auth] ensure_user_profile_exists failed",l)}},[]),u=o.useCallback(async l=>{const{data:v,error:x}=await I.from("user_profiles").select(["id","email","full_name","role","credits","stripe_customer_id","stripe_subscription_id","subscription_status","trial_status","trial_started_at","trial_expires_at","trial_ends_at","payment_verified","onboarding_completed","verification_method"].join(",")).eq("id",l).single();if(x)throw x;return v},[]),p=o.useCallback(async()=>{if(r!=null&&r.id)try{const l=await u(r.id);d(l),R(null)}catch(l){console.error("[Auth] refreshProfile failed",l),R("Could not load your profile. Please retry.")}},[u,r==null?void 0:r.id]);o.useEffect(()=>{let l=!1;(async()=>{j(!0),f(null);try{const h=new URLSearchParams(window.location.search),b=h.get("code"),S=h.get("error")||h.get("error_description");if(S){f(decodeURIComponent(S)),h.delete("error"),h.delete("error_description");const V=h.toString(),J=`${window.location.pathname}${V?`?${V}`:""}`;window.history.replaceState({},document.title,J);return}const de=await I.auth.getSession();de.error&&console.error("[Auth] getSession (pre) failed",de.error);let q=de.data.session??null;if(!q&&b)try{const{data:V,error:J}=await I.auth.exchangeCodeForSession(b);J?(console.error("[Auth] exchangeCodeForSession failed",J),f("OAuth callback failed. Please try again.")):q=V.session??null}finally{h.delete("code");const V=h.toString(),J=`${window.location.pathname}${V?`?${V}`:""}`;window.history.replaceState({},document.title,J)}l||(a(q),i((q==null?void 0:q.user)??null))}catch(h){console.error("[Auth] init failed",h),l||f("Auth initialization failed. Check Supabase env configuration.")}finally{l||(j(!1),y(!0))}})();const{data:x}=I.auth.onAuthStateChange((h,b)=>{a(b),i((b==null?void 0:b.user)??null)});return()=>{l=!0,x.subscription.unsubscribe()}},[]),o.useEffect(()=>{let l=!1;return(async()=>{if(!(r!=null&&r.id)){d(null);return}j(!0);try{await F();const x=await u(r.id);l||(d(x),R(null))}catch(x){console.error("[Auth] profile load failed",x),l||(d(null),R("We could not load your profile details."))}finally{l||j(!1)}})(),()=>{l=!0}},[F,u,r==null?void 0:r.id]);const D=o.useCallback(async l=>{f(null);let b=`${window.location.origin}/auth/callback?redirect=${encodeURIComponent(l||"/dashboard")}`;const{error:S}=await I.auth.signInWithOAuth({provider:"google",options:{redirectTo:b,queryParams:{access_type:"offline",prompt:"consent"},scopes:"openid email profile"}});if(S)throw console.error("[Auth] signInWithOAuth failed",S),f(S.message),S},[]),B=o.useCallback(async(l,v)=>{f(null);const{error:x}=await I.auth.signInWithPassword({email:l,password:v});if(x)throw f(x.message),x},[]),U=o.useCallback(async(l,v,x)=>{f(null);const{data:h,error:b}=await I.auth.signUp({email:v,password:x,options:{data:{full_name:l}}});if(b)throw f(b.message),b;return h.session?"signed_in":"needs_confirmation"},[]),re=o.useCallback(async l=>{f(null);const v=`${window.location.origin}/login`,{error:x}=await I.auth.resetPasswordForEmail(l,{redirectTo:v});if(x)throw f(x.message),x},[]),ne=o.useCallback(async()=>{f(null);const{error:l}=await I.auth.signOut();if(l)throw f(l.message),l},[]),M=o.useMemo(()=>{const l=(n==null?void 0:n.trial_expires_at)||(n==null?void 0:n.trial_ends_at)||null,v=(n==null?void 0:n.trial_status)==="active"&&kt(l),x=!!(n!=null&&n.payment_verified),h=!!(n!=null&&n.onboarding_completed),b=x||h||v;let S="Setup required";return x?S="Active":v?S="Trial":(n==null?void 0:n.trial_status)==="active"&&(S="Trial expired"),{isSubscribed:b,statusLabel:S,trialEndsAt:l}},[n]),Y=o.useCallback(()=>M.isSubscribed,[M.isSubscribed]),ie=o.useMemo(()=>({session:s,user:r,profile:n,isAuthReady:O,isLoading:N,authError:$,profileError:L,isSubscribed:Y,signInWithGoogle:D,signInWithEmail:B,signUpWithEmail:U,resetPassword:re,signOut:ne,refreshProfile:p,billing:M}),[s,r,n,O,N,$,L,Y,D,B,U,re,ne,p,M]);return e.jsx(Se.Provider,{value:ie,children:t})}function _t(){const t=o.useContext(Se);if(!t)throw new Error("useAuth must be used within AuthProvider");return t}const zt=xe("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function E({className:t,variant:s,size:a,asChild:r=!1,...i}){const n=r?me:"button";return e.jsx(n,{"data-slot":"button",className:m(zt({variant:s,size:a,className:t})),...i})}function le({className:t,type:s,...a}){return e.jsx("input",{type:s,"data-slot":"input",className:m("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}function At({className:t,...s}){return e.jsx(Ee,{"data-slot":"label",className:m("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}function ce({className:t,...s}){return e.jsx("textarea",{"data-slot":"textarea",className:m("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...s})}function Tt({className:t,value:s,...a}){return e.jsx(Ie,{"data-slot":"progress",className:m("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...a,children:e.jsx(Pe,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})})}function T({className:t,...s}){return e.jsx("div",{"data-slot":"card",className:m("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",t),...s})}const Et=H(["sales","leads","traffic","app_installs"]),It=H(["cold","warm","hot"]),Pt=H(["de","en"]),Ce=H(["1:1","4:5","9:16"]),Rt=H(["direct","luxury","playful","minimal","bold","trustworthy"]),ke=w({brand:w({name:c().min(1)}),product:w({name:c().min(1),url:c().url().nullable(),category:c().nullable()}),goal:Et,funnel_stage:It,language:Pt,format:Ce,audience:w({summary:c().min(1),segments:W(c().min(1)).min(1)}),offer:w({summary:c().nullable(),constraints:W(c().min(1)).default([])}),tone:Rt,angles:W(w({id:c().min(1),label:c().min(1),why_it_fits:c().min(1)})).min(2),risk_flags:W(w({type:c().min(1),severity:H(["low","medium","high"]),note:c().min(1)})).default([])}).strict(),_e=w({version:Ne("1.0"),brief:ke,creatives:W(w({id:c().min(1),angle_id:c().min(1),format:Ce,copy:w({hook:c().min(1).max(80),primary_text:c().min(1).max(700),cta:c().min(1).max(30),bullets:W(c().min(1).max(90)).max(6).default([])}),score:w({value:Nt().int().min(0).max(100),rationale:c().min(1).max(240)}),image:w({input_image_used:wt(),render_intent:c().min(1).max(200)})}).strict()).min(2).max(8)}).strict();function Q(t){const s="".trim();return s?`${s.replace(/\/$/,"")}${t}`:t}async function K(){var r;const{data:t,error:s}=await I.auth.getSession();if(s)throw new Error(s.message);const a=(r=t.session)==null?void 0:r.access_token;if(!a)throw new Error("Not authenticated.");return a}async function X(t){const s=await t.text();try{return s?JSON.parse(s):{}}catch{return{error:"Invalid server response."}}}async function $t(t){const s=await K(),a=await fetch(Q("/api/creative/analyze"),{method:"POST",headers:{Authorization:`Bearer ${s}`},body:t}),r=await X(a);if(!a.ok)throw new Error((r==null?void 0:r.error)??"Analyze failed");const i=ke.safeParse(r==null?void 0:r.brief);if(!i.success)throw new Error("Server returned invalid brief JSON.");return{brief:i.data,image:(r==null?void 0:r.image)??null,credits:(r==null?void 0:r.credits)??null}}async function Ft(t){const s=await K(),a=await fetch(Q("/api/creative/generate"),{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await X(a);if(!a.ok)throw new Error((r==null?void 0:r.error)??"Generate failed");let i=null;if(r!=null&&r.output){const n=_e.safeParse(r.output);if(!n.success)throw new Error("Server returned invalid CreativeOutput JSON.");i=n.data}return{output:i,credits:(r==null?void 0:r.credits)??null,quality:(r==null?void 0:r.quality)??null,jobId:(r==null?void 0:r.jobId)??null}}async function cs(t){const s=await K(),a=Q(`/api/creative/status?id=${encodeURIComponent(t)}`),r=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${s}`}}),i=await X(r);if(!r.ok)throw new Error((i==null?void 0:i.error)??"Status check failed");if(i!=null&&i.outputs){const n=_e.safeParse(i.outputs);if(!n.success)throw new Error("Server returned invalid CreativeOutput JSON in status");i.outputs=n.data}return i}async function Bt(){const t=await K(),s=await fetch(Q("/api/creative/save"),{method:"GET",headers:{Authorization:`Bearer ${t}`}}),a=await X(s);return s.ok?{enabled:!!(a!=null&&a.enabled),reason:(a==null?void 0:a.reason)??null}:{enabled:!1,reason:(a==null?void 0:a.error)??"Library not available"}}async function us(t=10){const s=await K(),a=Q(`/api/ad-research-list?limit=${encodeURIComponent(String(t))}`),r=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${s}`}}),i=await X(r);if(!r.ok)throw new Error((i==null?void 0:i.error)??"Failed to fetch ad research items");return i}async function Ut(t){const s=await K(),a=await fetch(Q("/api/creative/save"),{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await X(a);if(!a.ok)throw new Error((r==null?void 0:r.error)??"Save failed");return r}const Ot=xe("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function fe({className:t,variant:s,...a}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:m(Ot({variant:s}),t),...a})}function he({className:t,...s}){return e.jsx("div",{"data-slot":"alert-title",className:m("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...s})}function ge({className:t,...s}){return e.jsx("div",{"data-slot":"alert-description",className:m("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...s})}function pe({className:t,...s}){return e.jsx("div",{"data-slot":"skeleton",className:m("bg-accent animate-pulse rounded-md",t),...s})}const Lt=Re,ze=o.createContext({}),C=({...t})=>e.jsx(ze.Provider,{value:{name:t.name},children:e.jsx($e,{...t})}),oe=()=>{const t=o.useContext(ze),s=o.useContext(Ae),{getFieldState:a}=Fe(),r=Be({name:t.name}),i=a(t.name,r);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:n}=s;return{id:n,name:t.name,formItemId:`${n}-form-item`,formDescriptionId:`${n}-form-item-description`,formMessageId:`${n}-form-item-message`,...i}},Ae=o.createContext({});function k({className:t,...s}){const a=o.useId();return e.jsx(Ae.Provider,{value:{id:a},children:e.jsx("div",{"data-slot":"form-item",className:m("grid gap-2",t),...s})})}function _({className:t,...s}){const{error:a,formItemId:r}=oe();return e.jsx(At,{"data-slot":"form-label","data-error":!!a,className:m("data-[error=true]:text-destructive",t),htmlFor:r,...s})}function z({...t}){const{error:s,formItemId:a,formDescriptionId:r,formMessageId:i}=oe();return e.jsx(me,{"data-slot":"form-control",id:a,"aria-describedby":s?`${r} ${i}`:`${r}`,"aria-invalid":!!s,...t})}function ve({className:t,...s}){const{formDescriptionId:a}=oe();return e.jsx("p",{"data-slot":"form-description",id:a,className:m("text-muted-foreground text-sm",t),...s})}function A({className:t,...s}){const{error:a,formMessageId:r}=oe(),i=a?String((a==null?void 0:a.message)??""):s.children;return i?e.jsx("p",{"data-slot":"form-message",id:r,className:m("text-destructive text-sm",t),...s,children:i}):null}const Dt=xe("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function P({className:t,variant:s,asChild:a=!1,...r}){const i=a?me:"span";return e.jsx(i,{"data-slot":"badge",className:m(Dt({variant:s}),t),...r})}function Vt(t){const s=t.step===1?33:t.step===2?66:100;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xl font-semibold text-foreground",children:t.title}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.subtitle})]}),e.jsxs(P,{variant:"secondary",children:["Step ",t.step,"/3"]})]}),e.jsx(Tt,{value:s}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:t.step===1?"text-foreground":"",children:"1) Input"}),e.jsx("span",{children:"•"}),e.jsx("span",{className:t.step===2?"text-foreground":"",children:"2) Review"}),e.jsx("span",{children:"•"}),e.jsx("span",{className:t.step===3?"text-foreground":"",children:"3) Results"})]})]})}function Mt(t){const s=o.useRef(null),a=o.useMemo(()=>t.value?URL.createObjectURL(t.value):null,[t.value]);o.useEffect(()=>()=>{a&&URL.revokeObjectURL(a)},[a]);const r="image/png,image/jpeg,image/webp",i=()=>{var d;return(d=s.current)==null?void 0:d.click()},n=d=>{if(!d||d.length===0)return;const N=d[0];t.onChange(N)};return e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:m("relative flex min-h-[220px] w-full items-center justify-center rounded-xl border border-dashed border-border bg-muted/20 p-4 text-center transition-colors","hover:bg-muted/30"),onDragOver:d=>{d.preventDefault(),d.stopPropagation()},onDrop:d=>{d.preventDefault(),d.stopPropagation(),n(d.dataTransfer.files)},role:"button",tabIndex:0,onClick:i,onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&i()},children:[e.jsx("input",{ref:s,type:"file",accept:r,className:"hidden",onChange:d=>n(d.target.files)}),!t.value&&e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-card border border-border",children:e.jsx(Ue,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("div",{className:"text-sm font-medium",children:"Drop your image here"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"JPG / PNG / WebP • up to 10MB • optional"}),e.jsx(E,{type:"button",variant:"secondary",size:"sm",className:"mt-1",onClick:i,children:"Choose file"})]}),t.value&&a&&e.jsxs("div",{className:"absolute inset-0 overflow-hidden rounded-xl",children:[e.jsx("img",{src:a,alt:"Uploaded preview",className:"h-full w-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3 flex items-end justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-medium text-white",children:t.value.name}),e.jsxs("div",{className:"text-xs text-white/80",children:[(t.value.size/(1024*1024)).toFixed(2)," MB"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{type:"button",variant:"secondary",size:"sm",onClick:d=>{d.preventDefault(),d.stopPropagation(),i()},children:"Replace"}),e.jsx(E,{type:"button",variant:"secondary",size:"icon",onClick:d=>{d.preventDefault(),d.stopPropagation(),t.onChange(null)},"aria-label":"Remove image",children:e.jsx(Oe,{className:"h-4 w-4"})})]})]})]})]})})}function Z({...t}){return e.jsx(Le,{"data-slot":"select",...t})}function ee({...t}){return e.jsx(Me,{"data-slot":"select-value",...t})}function te({className:t,size:s="default",children:a,...r}){return e.jsxs(De,{"data-slot":"select-trigger","data-size":s,className:m("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...r,children:[a,e.jsx(Ve,{asChild:!0,children:e.jsx(ye,{className:"size-4 opacity-50"})})]})}function se({className:t,children:s,position:a="popper",...r}){return e.jsx(qe,{children:e.jsxs(Je,{"data-slot":"select-content",className:m("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...r,children:[e.jsx(qt,{}),e.jsx(Ge,{className:m("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),e.jsx(Jt,{})]})})}function g({className:t,children:s,...a}){return e.jsxs(We,{"data-slot":"select-item",className:m("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...a,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(He,{children:e.jsx(Qe,{className:"size-4"})})}),e.jsx(Ke,{children:s})]})}function qt({className:t,...s}){return e.jsx(Xe,{"data-slot":"select-scroll-up-button",className:m("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Ye,{className:"size-4"})})}function Jt({className:t,...s}){return e.jsx(Ze,{"data-slot":"select-scroll-down-button",className:m("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(ye,{className:"size-4"})})}function Gt(t){const{control:s}=t.form;return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(C,{control:s,name:"brandName",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Brand"}),e.jsx(z,{children:e.jsx(le,{placeholder:"e.g. AdRuby",...a})}),e.jsx(A,{})]})}),e.jsx(C,{control:s,name:"productName",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Product"}),e.jsx(z,{children:e.jsx(le,{placeholder:"e.g. Creative Builder",...a})}),e.jsx(A,{})]})})]}),e.jsx(C,{control:s,name:"productUrl",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Product URL (optional)"}),e.jsx(z,{children:e.jsx(le,{placeholder:"https://example.com",...a})}),e.jsx(ve,{children:"Used for context only. Must be a valid URL if provided."}),e.jsx(A,{})]})}),e.jsx(C,{control:s,name:"audience",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Audience"}),e.jsx(z,{children:e.jsx(ce,{placeholder:"Who is this for? (pain points, context, objections)",rows:4,...a})}),e.jsx(ve,{children:"Example: “busy founders who need ad creatives fast, no in-house design team”"}),e.jsx(A,{})]})}),e.jsx(C,{control:s,name:"offer",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Offer (optional)"}),e.jsx(z,{children:e.jsx(ce,{placeholder:"e.g. 14-day trial, discount, bundle, bonus",rows:2,...a})}),e.jsx(A,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(C,{control:s,name:"goal",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Goal"}),e.jsxs(Z,{value:a.value,onValueChange:a.onChange,children:[e.jsx(z,{children:e.jsx(te,{children:e.jsx(ee,{placeholder:"Select goal"})})}),e.jsxs(se,{children:[e.jsx(g,{value:"sales",children:"Sales"}),e.jsx(g,{value:"leads",children:"Leads"}),e.jsx(g,{value:"traffic",children:"Traffic"}),e.jsx(g,{value:"app_installs",children:"App installs"})]})]}),e.jsx(A,{})]})}),e.jsx(C,{control:s,name:"funnel",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Funnel stage"}),e.jsxs(Z,{value:a.value,onValueChange:a.onChange,children:[e.jsx(z,{children:e.jsx(te,{children:e.jsx(ee,{placeholder:"Select stage"})})}),e.jsxs(se,{children:[e.jsx(g,{value:"cold",children:"Cold"}),e.jsx(g,{value:"warm",children:"Warm"}),e.jsx(g,{value:"hot",children:"Hot"})]})]}),e.jsx(A,{})]})}),e.jsx(C,{control:s,name:"tone",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Tone"}),e.jsxs(Z,{value:a.value,onValueChange:a.onChange,children:[e.jsx(z,{children:e.jsx(te,{children:e.jsx(ee,{placeholder:"Select tone"})})}),e.jsxs(se,{children:[e.jsx(g,{value:"direct",children:"Direct"}),e.jsx(g,{value:"trustworthy",children:"Trustworthy"}),e.jsx(g,{value:"bold",children:"Bold"}),e.jsx(g,{value:"minimal",children:"Minimal"}),e.jsx(g,{value:"playful",children:"Playful"}),e.jsx(g,{value:"luxury",children:"Luxury"})]})]}),e.jsx(A,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(C,{control:s,name:"language",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Language"}),e.jsxs(Z,{value:a.value,onValueChange:a.onChange,children:[e.jsx(z,{children:e.jsx(te,{children:e.jsx(ee,{placeholder:"Select language"})})}),e.jsxs(se,{children:[e.jsx(g,{value:"de",children:"Deutsch"}),e.jsx(g,{value:"en",children:"English"})]})]}),e.jsx(A,{})]})}),e.jsx(C,{control:s,name:"format",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Format"}),e.jsxs(Z,{value:a.value,onValueChange:a.onChange,children:[e.jsx(z,{children:e.jsx(te,{children:e.jsx(ee,{placeholder:"Select format"})})}),e.jsxs(se,{children:[e.jsx(g,{value:"1:1",children:"1:1"}),e.jsx(g,{value:"4:5",children:"4:5"}),e.jsx(g,{value:"9:16",children:"9:16"})]})]}),e.jsx(A,{})]})}),e.jsx(C,{control:s,name:"avoidClaims",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Claims to avoid (optional)"}),e.jsx(z,{children:e.jsx(le,{placeholder:'e.g. "guaranteed results", "100%"',...a})}),e.jsx(A,{})]})})]}),e.jsx(C,{control:s,name:"inspiration",render:({field:a})=>e.jsxs(k,{children:[e.jsx(_,{children:"Inspiration (optional)"}),e.jsx(z,{children:e.jsx(ce,{placeholder:"Any style notes, competitor references, or key messages",rows:2,...a})}),e.jsx(A,{})]})})]})}function G({className:t,orientation:s="horizontal",decorative:a=!0,...r}){return e.jsx(et,{"data-slot":"separator-root",decorative:a,orientation:s,className:m("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...r})}function Wt(t){return t==="high"?"destructive":t==="medium"?"secondary":"outline"}function ue(t){return String(t||"").replaceAll("_"," ").replaceAll("-"," ").trim()}function Ht(t){var a;const{brief:s}=t;return e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(T,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Brief (normalized)"}),e.jsx(G,{className:"my-3"}),e.jsxs("div",{className:"grid gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"text-muted-foreground",children:"Brand"}),e.jsx("div",{className:"text-right font-medium",children:s.brand.name})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"text-muted-foreground",children:"Product"}),e.jsx("div",{className:"text-right font-medium",children:s.product.name})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"text-muted-foreground",children:"Goal"}),e.jsx("div",{className:"text-right font-medium",children:ue(s.goal)})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"text-muted-foreground",children:"Funnel"}),e.jsx("div",{className:"text-right font-medium",children:ue(s.funnel_stage)})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"text-muted-foreground",children:"Language"}),e.jsx("div",{className:"text-right font-medium",children:s.language.toUpperCase()})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"text-muted-foreground",children:"Format"}),e.jsx("div",{className:"text-right font-medium",children:s.format})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"text-muted-foreground",children:"Tone"}),e.jsx("div",{className:"text-right font-medium",children:ue(s.tone)})]})]})]}),e.jsxs(T,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Audience"}),e.jsx(G,{className:"my-3"}),e.jsx("div",{className:"text-sm text-foreground",children:s.audience.summary}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:s.audience.segments.map(r=>e.jsx(P,{variant:"secondary",children:r},r))})]}),e.jsxs(T,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Offer"}),e.jsx(G,{className:"my-3"}),e.jsx("div",{className:"text-sm text-foreground",children:s.offer.summary?s.offer.summary:e.jsx("span",{className:"text-muted-foreground",children:"No explicit offer provided."})}),((a=s.offer.constraints)==null?void 0:a.length)>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:s.offer.constraints.map(r=>e.jsx(P,{variant:"outline",children:r},r))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(T,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Angles"}),e.jsx(G,{className:"my-3"}),e.jsx("div",{className:"grid gap-3",children:s.angles.map(r=>e.jsxs("div",{className:"rounded-lg border border-border bg-card p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm font-medium",children:r.label}),e.jsx(P,{variant:"outline",children:r.id})]}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:r.why_it_fits})]},r.id))})]}),e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Risk flags"}),e.jsx(P,{variant:s.risk_flags.length?"secondary":"outline",children:s.risk_flags.length?`${s.risk_flags.length} found`:"none"})]}),e.jsx(G,{className:"my-3"}),s.risk_flags.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No obvious compliance risks detected."}):e.jsx("div",{className:"grid gap-2",children:s.risk_flags.map((r,i)=>e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium",children:r.type}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r.note})]}),e.jsx(P,{variant:Wt(r.severity),children:r.severity})]},`${r.type}-${i}`))})]})]})]})}function Qt({className:t,...s}){return e.jsx(tt,{"data-slot":"tabs",className:m("flex flex-col gap-2",t),...s})}function Kt({className:t,...s}){return e.jsx(st,{"data-slot":"tabs-list",className:m("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",t),...s})}function be({className:t,...s}){return e.jsx(at,{"data-slot":"tabs-trigger",className:m("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function je({className:t,...s}){return e.jsx(rt,{"data-slot":"tabs-content",className:m("flex-1 outline-none",t),...s})}function Te({delayDuration:t=0,...s}){return e.jsx(nt,{"data-slot":"tooltip-provider",delayDuration:t,...s})}function Xt({...t}){return e.jsx(Te,{children:e.jsx(it,{"data-slot":"tooltip",...t})})}function Yt({...t}){return e.jsx(lt,{"data-slot":"tooltip-trigger",...t})}function Zt({className:t,sideOffset:s=0,children:a,...r}){return e.jsx(ot,{children:e.jsxs(dt,{"data-slot":"tooltip-content",sideOffset:s,className:m("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...r,children:[a,e.jsx(ct,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}function es(t){var i;const s=t.creative,a=s.score.value>=85?"default":s.score.value>=70?"secondary":"outline",r=()=>{var d,N;const n=[`Hook: ${s.copy.hook}`,"",s.copy.primary_text,"",`CTA: ${s.copy.cta}`,...(d=s.copy.bullets)!=null&&d.length?["","Bullets:",...s.copy.bullets.map(j=>`- ${j}`)]:[]].join(`
`);(N=t.onCopy)==null||N.call(t,n)};return e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(P,{variant:"outline",children:t.angleLabel??s.angle_id}),e.jsxs(P,{variant:a,children:["Score ",s.score.value]}),e.jsx(P,{variant:"secondary",children:s.format})]}),e.jsx("div",{className:"mt-2 text-base font-semibold leading-snug",children:s.copy.hook})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-2",children:[t.actions,e.jsx(E,{type:"button",variant:"secondary",size:"icon",onClick:()=>{r(),ae.success("Copied ad copy")},"aria-label":"Copy ad copy",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx(E,{type:"button",variant:"secondary",size:"icon",onClick:()=>{var n;return(n=t.onDuplicate)==null?void 0:n.call(t)},"aria-label":"Create variant",title:"Create variant",children:e.jsx(ut,{className:"h-4 w-4"})})]})]}),e.jsx(G,{className:"my-3"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("div",{className:"whitespace-pre-wrap text-foreground",children:s.copy.primary_text}),((i=s.copy.bullets)==null?void 0:i.length)>0&&e.jsx("ul",{className:"list-disc pl-5 text-muted-foreground",children:s.copy.bullets.map(n=>e.jsx("li",{children:n},n))}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:"CTA:"})," ",s.copy.cta]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.score.rationale})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-muted/20 p-3 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Render intent:"})," ",s.image.render_intent]})]})]})}function ts({className:t,children:s,...a}){return e.jsxs(mt,{"data-slot":"scroll-area",className:m("relative",t),...a,children:[e.jsx(xt,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:s}),e.jsx(ss,{}),e.jsx(ft,{})]})}function ss({className:t,orientation:s="vertical",...a}){return e.jsx(ht,{"data-slot":"scroll-area-scrollbar",orientation:s,className:m("flex touch-none p-px transition-colors select-none",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",t),...a,children:e.jsx(gt,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function as(t){const s=JSON.stringify(t.value,null,2),a=async()=>{try{await navigator.clipboard.writeText(s),ae.success("JSON copied")}catch{ae.error("Copy failed")}};return e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm font-semibold",children:t.title??"JSON"}),e.jsxs(E,{type:"button",size:"sm",variant:"secondary",onClick:a,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Copy"]})]}),e.jsx("div",{className:"mt-3 rounded-lg border border-border bg-muted/20",children:e.jsx(ts,{className:"h-[520px] w-full",children:e.jsx("pre",{className:"p-4 text-xs leading-relaxed",children:e.jsx("code",{children:s})})})})]})}function rs(t){var R,F;const[s,a]=o.useState(t.output.creatives),[r,i]=o.useState(!1),[n,d]=o.useState(!1),[N,j]=o.useState(null);o.useEffect(()=>{a(t.output.creatives)},[t.output]),o.useEffect(()=>{let u=!0;return Bt().then(p=>{u&&(d(p.enabled),j(p.reason??null))}).catch(()=>{u&&(d(!1),j("Library module not configured yet."))}),()=>{u=!1}},[]);const O=o.useMemo(()=>{const u=new Map;for(const p of t.output.brief.angles)u.set(p.id,p.label);return u},[t.output.brief.angles]),y=(R=t.quality)==null?void 0:R.satisfaction,$=((F=t.quality)==null?void 0:F.target)??95,f=typeof y=="number"&&y>=$?"default":typeof y=="number"&&y>=80?"secondary":"outline";async function L(){i(!0);try{await Ut({output:{...t.output,creatives:s}}),ae.success("Saved to Library")}catch(u){ae.error(u instanceof Error?u.message:"Save failed")}finally{i(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Results"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.length," creatives generated • Format ",t.output.brief.format," •"," ",t.output.brief.language.toUpperCase()]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[typeof y=="number"&&e.jsxs(P,{variant:f,children:["Quality ",y,"/",$]}),e.jsxs(E,{type:"button",variant:"secondary",onClick:t.onReset,children:[e.jsx(pt,{className:"mr-2 h-4 w-4"}),"New brief"]}),e.jsx(Te,{children:e.jsxs(Xt,{children:[e.jsx(Yt,{asChild:!0,children:e.jsx("span",{children:e.jsxs(E,{type:"button",disabled:!n||r,onClick:L,children:[e.jsx(vt,{className:"mr-2 h-4 w-4"}),r?"Saving…":"Save to Library"]})})}),!n&&e.jsx(Zt,{children:N??"Library module not configured yet."})]})})]})]})}),e.jsxs(Qt,{defaultValue:"creatives",children:[e.jsxs(Kt,{children:[e.jsx(be,{value:"creatives",children:"Creatives"}),e.jsx(be,{value:"json",children:"JSON"})]}),e.jsx(je,{value:"creatives",children:e.jsx("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:s.map(u=>e.jsx(es,{creative:u,angleLabel:O.get(u.angle_id)??u.angle_id,onDuplicate:()=>{const p=crypto.randomUUID();a(D=>[...D,{...u,id:p,score:{...u.score,value:Math.max(0,Math.min(100,Math.trunc(u.score.value-2))),rationale:`Variant of ${u.id}. ${u.score.rationale}`.slice(0,240)}}])},onCopy:async p=>{await navigator.clipboard.writeText(p)}},u.id))})}),e.jsx(je,{value:"json",children:e.jsx(as,{value:{...t.output,creatives:s},title:"CreativeOutput JSON"})})]})]})}const ns=w({brandName:c().min(1,"Brand is required"),productName:c().min(1,"Product is required"),productUrl:c().url().optional().or(Ne("")),offer:c().optional(),audience:c().min(1,"Audience is required"),tone:c().min(1),goal:c().min(1),funnel:c().min(1),language:c().min(1),format:c().min(1),inspiration:c().optional(),avoidClaims:c().optional()});function ms(){const{session:t,isAuthReady:s,isLoading:a,authError:r}=_t(),[i,n]=o.useState(1),[d,N]=o.useState(null),[j,O]=o.useState(null),[y,$]=o.useState(null),[f,L]=o.useState(null),[R,F]=o.useState(null),[u,p]=o.useState(null),[D,B]=o.useState(null),U=bt({resolver:St(ns),defaultValues:{brandName:"",productName:"",productUrl:"",offer:"",audience:"",tone:"direct",goal:"sales",funnel:"cold",language:"de",format:"4:5",inspiration:"",avoidClaims:""},mode:"onChange"}),re=U.formState.isValid&&!u&&s&&!a&&!!t;async function ne(){B(null),p("analyze");try{const l=U.getValues(),v=new FormData;Object.entries(l).forEach(([h,b])=>v.append(h,String(b??""))),d&&v.append("image",d);const x=await $t(v);$(x.brief),O(x.image??null),n(2)}catch(l){B(l instanceof Error?l.message:"Analyze failed.")}finally{p(null)}}async function M(){if(y){B(null),p("generate");try{const l=await Ft({brief:y,hasImage:!!d});L(l.output),F(l.quality!=null?{satisfaction:l.quality}:null),n(3)}catch(l){B(l instanceof Error?l.message:"Generate failed.")}finally{p(null)}}}function Y(){U.reset(),N(null),O(null),$(null),L(null),F(null),B(null),n(1)}const ie=o.useMemo(()=>!s||a?{kind:"loading"}:t?{kind:"ok"}:{kind:"missing"},[s,a,t]);return e.jsxs("div",{className:"mx-auto w-full max-w-6xl space-y-6",children:[e.jsx(Vt,{title:"Create Ad Creative",subtitle:"Analyze input into a strict brief JSON, then generate variants with a quality gate.",step:i}),ie.kind==="loading"&&e.jsxs(T,{className:"p-5",children:[e.jsx(pe,{className:"h-4 w-56"}),e.jsx(pe,{className:"mt-3 h-4 w-80"})]}),ie.kind==="missing"&&e.jsxs(fe,{children:[e.jsx(he,{children:"Authentication required"}),e.jsx(ge,{children:r||"You need a valid Supabase session to use Creative Builder. Please log in, then retry."})]}),D&&e.jsxs(fe,{variant:"destructive",children:[e.jsx(he,{children:"Error"}),e.jsx(ge,{children:D})]}),i===1&&e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsxs(T,{className:"p-5",children:[e.jsx(Mt,{value:d,onChange:N}),(j==null?void 0:j.path)&&e.jsxs("div",{className:"mt-3 text-xs text-muted-foreground",children:["Uploaded to storage: ",e.jsx("span",{className:"font-medium",children:j.path})]})]}),e.jsx(T,{className:"p-5",children:e.jsx(Lt,{...U,children:e.jsxs("form",{className:"space-y-5",onSubmit:l=>l.preventDefault(),children:[e.jsx(Gt,{form:U}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(E,{disabled:!re,onClick:ne,type:"button",children:u==="analyze"?"Analyzing…":"Analyse & JSON erstellen"}),e.jsx(E,{variant:"secondary",onClick:Y,disabled:!!u,type:"button",children:"Zurücksetzen"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Next: We will normalize your input into a strict brief JSON (Step 2)."})]})})})]}),i===2&&y&&e.jsxs(T,{className:"p-5",children:[e.jsx(Ht,{brief:y}),e.jsxs("div",{className:"mt-5 flex flex-wrap gap-3",children:[e.jsx(E,{onClick:M,disabled:u==="generate",type:"button",children:u==="generate"?"Generating…":"Creatives generieren"}),e.jsx(E,{variant:"secondary",onClick:()=>n(1),disabled:!!u,type:"button",children:"Brief bearbeiten"})]}),e.jsx("div",{className:"mt-3 text-xs text-muted-foreground",children:"Step 3 generates 4–6 variants and reruns an AI quality check until it meets the target (best effort)."})]}),i===3&&f&&e.jsx(rs,{output:f,quality:R,onReset:Y})]})}export{ds as A,E as B,T as C,le as I,At as L,Tt as P,ce as T,$t as a,Ft as b,m as c,cs as d,Ut as e,us as f,ms as g,P as h,I as s,_t as u};
